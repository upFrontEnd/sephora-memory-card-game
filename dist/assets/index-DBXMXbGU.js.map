{"version":3,"file":"index-DBXMXbGU.js","sources":["../../src/js/modules/theme-toggle.js","../../src/js/modules/sound.js","../../src/js/modules/shuffle.js","../../src/js/modules/a11y.js","../../src/js/modules/game.js","../../src/js/main.js"],"sourcesContent":["const STORAGE_KEY = \"theme\"; // \"light\" | \"dark\"\r\n\r\nfunction getPreferredTheme() {\r\n  const saved = localStorage.getItem(STORAGE_KEY);\r\n  if (saved === \"light\" || saved === \"dark\") return saved;\r\n\r\n  const prefersDark = window.matchMedia?.(\"(prefers-color-scheme: dark)\")?.matches;\r\n  return prefersDark ? \"dark\" : \"light\";\r\n}\r\n\r\nfunction applyTheme(theme) {\r\n  const root = document.documentElement; // <html>\r\n  root.dataset.theme = theme;\r\n  root.style.colorScheme = theme; // aide les controls natifs\r\n\r\n  // Switch: on garde le visuel CodePen (checked = soleil / unchecked = lune)\r\n  const input = document.getElementById(\"theme-switch\");\r\n  if (input) {\r\n    input.checked = theme === \"light\";\r\n    input.setAttribute(\"aria-checked\", String(input.checked));\r\n  }\r\n\r\n  localStorage.setItem(STORAGE_KEY, theme);\r\n}\r\n\r\nexport function initThemeToggle() {\r\n  const input = document.getElementById(\"theme-switch\");\r\n  if (!input) return;\r\n\r\n  // init\r\n  applyTheme(getPreferredTheme());\r\n\r\n  // toggle\r\n  input.addEventListener(\"change\", () => {\r\n    const nextTheme = input.checked ? \"light\" : \"dark\";\r\n    applyTheme(nextTheme);\r\n  });\r\n}\r\n","const SOUND_PATHS = {\r\n  flip: \"/sound/flip.mp3\",     \r\n  match: \"/sound/match.mp3\",   \r\n  win: \"/sound/win.mp3\",       \r\n};\r\n\r\n// Volume par son (0 = muet, 1 = max)\r\nconst SOUND_VOLUME = {\r\n  flip: 1,\r\n  unflip: 1,\r\n  match: 1,\r\n  win: 0.1,\r\n};\r\n\r\n// Etat global du son (accessible par playSound)\r\nconst soundState = {\r\n  enabled: false, // état initial : son coupé\r\n};\r\n\r\n// Cache des instances Audio pour éviter de recréer à chaque fois\r\nconst audioMap = {};\r\n\r\n/**\r\n * Crée et configure une instance Audio pour un son.\r\n */\r\nfunction createAudio(key) {\r\n  const src = SOUND_PATHS[key];\r\n  if (!src) return null;\r\n\r\n  const audio = new Audio(src);\r\n  audio.preload = \"auto\";\r\n\r\n  const volume = SOUND_VOLUME[key];\r\n  audio.volume = typeof volume === \"number\" ? volume : 1;\r\n\r\n  audioMap[key] = audio;\r\n  return audio;\r\n}\r\n\r\n/**\r\n * Récupère (ou crée) une instance Audio pour un son donné.\r\n * @param {string} key - \"flip\" | \"match\" | \"win\"\r\n */\r\nfunction getAudio(key) {\r\n  if (audioMap[key]) return audioMap[key];\r\n  return createAudio(key);\r\n}\r\n\r\n/**\r\n * Précharge tous les sons au chargement de la page.\r\n * Appelle simplement .load() sur chaque Audio.\r\n */\r\nexport function preloadAllSounds() {\r\n  Object.keys(SOUND_PATHS).forEach((key) => {\r\n    const audio = getAudio(key);\r\n    if (audio) {\r\n      audio.load();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Joue un son si le son est activé.\r\n * @param {\"flip\" | \"match\" | \"win\"} name\r\n */\r\nexport function playSound(name) {\r\n  if (!soundState.enabled) return;\r\n\r\n  const audio = getAudio(name);\r\n  if (!audio) return;\r\n\r\n  audio.currentTime = 0;\r\n  audio.play().catch(() => {\r\n    // En cas de blocage navigateur, on ne casse pas le jeu\r\n  });\r\n}\r\n\r\n/**\r\n * Initialise le bouton de bascule du son (icône haut-parleur).\r\n * Met à jour soundState.enabled + l'UI (aria + classes).\r\n */\r\nexport function initSoundToggle() {\r\n  const button = document.querySelector(\".sound-toggle\");\r\n  if (!button) return;\r\n\r\n  function render() {\r\n    if (soundState.enabled) {\r\n      button.classList.add(\"sound-toggle--on\");\r\n      button.setAttribute(\"aria-pressed\", \"true\");\r\n      button.setAttribute(\"aria-label\", \"Désactiver le son\");\r\n    } else {\r\n      button.classList.remove(\"sound-toggle--on\");\r\n      button.setAttribute(\"aria-pressed\", \"false\");\r\n      button.setAttribute(\"aria-label\", \"Activer le son\");\r\n    }\r\n  }\r\n\r\n  button.addEventListener(\"click\", () => {\r\n    soundState.enabled = !soundState.enabled;\r\n    render();\r\n  });\r\n\r\n  // Premier rendu cohérent avec l'état initial (son OFF)\r\n  render();\r\n}\r\n","export function shuffleCards(cards) {\n  const total = cards.length;\n  cards.forEach((card) => {\n    card.style.order = Math.floor(Math.random() * total);\n  });\n}\n","/**\r\n * Rend une carte de memory accessible :\r\n * - role=\"button\" (si non déjà présent dans le HTML)\r\n * - focusable au clavier (Tab)\r\n * - activation clavier avec Entrée / Espace (simule un clic)\r\n */\r\nexport function enhanceMemoryCard(card) {\r\n    if (!card) return;\r\n  \r\n    // Sémantique minimale (ne gêne pas si déjà défini dans le HTML)\r\n    if (!card.hasAttribute(\"role\")) {\r\n      card.setAttribute(\"role\", \"button\");\r\n    }\r\n    if (!card.hasAttribute(\"tabindex\")) {\r\n      card.setAttribute(\"tabindex\", \"0\");\r\n    }\r\n  \r\n    function handleKeyDown(event) {\r\n      const { key } = event;\r\n      if (key === \"Enter\" || key === \" \") {\r\n        event.preventDefault();\r\n        card.click(); // déclenche la même logique que le clic souris\r\n      }\r\n    }\r\n  \r\n    card.addEventListener(\"keydown\", handleKeyDown);\r\n  }\r\n  \r\n  /**\r\n   * Initialise l’accessibilité pour une liste de cartes.\r\n   */\r\n  export function initCardsA11y(cards) {\r\n    cards.forEach((card) => enhanceMemoryCard(card));\r\n  }\r\n  ","import { shuffleCards } from \"./shuffle.js\";\nimport { playSound } from \"./sound.js\";\nimport { initCardsA11y } from \"./a11y.js\";\n\nexport function createGame() {\n\n  const cards = Array.from(document.querySelectorAll(\".memory-card\"));\n  \n  const gameContainer = document.querySelector(\".memory-game\");\n  const overlay = document.querySelector(\".win-overlay\");\n  const lottieEl = document.querySelector(\"#win-lottie\");\n  const replayButton = document.querySelector(\".replay-button\");\n\n  // === Etat du jeu ===\n  let hasFlippedCard = false; // indique si on a déjà retourné 1 carte (en attente de la 2e)\n  let lockBoard = false;      // true = le plateau est verrouillé pendant une animation, false = clics autorisés\n  let firstCard = null;       // référence DOM de la 1ère carte retournée\n  let secondCard = null;      // référence DOM de la 2e carte retournée\n\n  /**\n   * Remet l’état interne du tour à zéro (qu’il y ait eu match ou non).\n   * Ne touche pas à l’état global \"win\" ni à l’overlay.\n   */\n  function resetBoard() {\n    hasFlippedCard = false;\n    lockBoard = false;\n    firstCard = null;\n    secondCard = null;\n  }\n\n  /**\n   * Cas \"Non match\" :\n   * - on bloque temporairement le plateau\n   * - on re-retourne les deux cartes après un délai \n   */\n  function unflipCard() {\n    lockBoard = true; // on bloque les clics pendant le \"retournement\"\n\n    setTimeout(() => {\n      firstCard.classList.remove(\"flip\");\n      secondCard.classList.remove(\"flip\");\n      lockBoard = false; // on ré-autorise les clics après l’animation\n    }, 900); \n  }\n\n  /**\n   * Cas \"match\" :\n   * - on capture les deux cartes matchées\n   * - on enlève leurs listeners de clic (plus cliquables)\n   * - on leur applique un style \"trouvé\" (memory-card-shadow)\n   * - on vérifie ensuite si toutes les cartes sont trouvées (victoire)\n   */\n  function disableCards() {\n    lockBoard = true; // bloque les clics pendant qu'on “finalise” le match\n\n    // On capture les références au moment du match pour éviter que\n    // firstCard/secondCard soient modifiées avant le setTimeout\n    const matchedA = firstCard;\n    const matchedB = secondCard;\n\n    matchedA.removeEventListener(\"click\", flipCard);\n    matchedB.removeEventListener(\"click\", flipCard);\n\n    setTimeout(() => {\n      matchedA.classList.add(\"memory-card-shadow\");\n      matchedB.classList.add(\"memory-card-shadow\");\n\n      resetBoard();       // Prépare le tour suivant (et déverrouille le plateau)\n      allFlippedCard();   // Vérifie si la partie est gagnée\n      playSound(\"match\"); // Son de \"match\" déclenché après validation du match\n    }, 900);\n  }\n\n  /**\n   * Compare les deux cartes retournées via leur data-attribute\n   * (ex: data-product=\"lipstick\").\n   * - Si match → on les \"gèle\" (disableCards)\n   * - Sinon → on les re-retourne (unflipCard)\n   */\n  function checkForMatch() {\n    const isMatch = firstCard.dataset.product === secondCard.dataset.product;\n    isMatch ? disableCards() : unflipCard();\n  }\n\n  /**\n   * Handler de clic / activation sur une carte :\n   * - ignore si le plateau est verrouillé\n   * - ignore si on reclique sur la même carte\n   * - gère la logique \"1ère carte / 2ème carte\", puis lance la comparaison\n   */\n  function flipCard() {\n    // Si le plateau est verrouillé (animation en cours), on ignore le clic\n    if (lockBoard) return;\n\n    // Empêche de double-cliquer la même carte comme \"2e carte\"\n    if (this === firstCard) return;\n\n    // On retourne visuellement la carte (CSS: .flip => rotateY(180deg))\n    this.classList.add(\"flip\");\n\n    // Son de flip (déclenché à chaque carte retournée)\n    playSound(\"flip\");\n\n    // Si c’est la 1ère carte du tour :\n    if (!hasFlippedCard) {\n      hasFlippedCard = true; // on attend maintenant une 2e carte\n      firstCard = this;      // mémorise la 1ère carte\n      return;\n    }\n\n    // Sinon, c’est la 2e carte :\n    hasFlippedCard = false; // le tour est \"complet\", on repasse à false\n    secondCard = this;      // mémorise la 2e carte\n    checkForMatch();        // on compare les deux\n  }\n\n  /**\n   * Affiche l’overlay de victoire et lance l’animation Lottie.\n   */\n  // function playWinLottie() {\n  //   if (!overlay || !lottieEl) return;\n\n  //   overlay.hidden = false;\n\n  //   const start = () => lottieEl.dotLottie?.play?.();\n  //   if (lottieEl.dotLottie) {\n  //     start();\n  //   } else {\n  //     lottieEl.addEventListener(\"ready\", start, { once: true });\n  //   }\n  // }\n\n  /**\n   * Vérifie si toutes les cartes ont été trouvées :\n   * - on compte le nombre total de cartes\n   * - on compte combien ont la classe \"memory-card-shadow\"\n   * - si tous les éléments sont matchés, on passe en mode \"win\"\n   *   (classe .win sur le conteneur + animation Lottie + son de victoire)\n   */\n  function allFlippedCard() {\n    if (!gameContainer) return;\n    if (gameContainer.classList.contains(\"win\")) return;\n\n    const total = cards.length;\n    const matched = document.querySelectorAll(\".memory-card.memory-card-shadow\").length;\n\n    if (total > 0 && matched === total) {\n      gameContainer.classList.add(\"win\");\n      playSound(\"win\");\n      playWinLottie();\n    }\n  }\n\n  /**\n   * Réinitialise complètement la partie.\n   */\n  function restartGame() {\n    resetBoard();\n\n    cards.forEach((card) => {\n      card.classList.remove(\"flip\", \"memory-card-shadow\");\n      card.addEventListener(\"click\", flipCard);\n    });\n\n    if (gameContainer) {\n      gameContainer.classList.remove(\"win\");\n    }\n\n    if (overlay) {\n      overlay.hidden = true;\n    }\n    if (lottieEl?.dotLottie) {\n      lottieEl.dotLottie.stop();\n    }\n\n    shuffleCards(cards);\n  }\n\n  /**\n   * Démarre le jeu :\n   * - mélange les cartes\n   * - attache les listeners de clic sur chaque carte\n   * - initialise l’A11y (role, tabindex, clavier)\n   * - attache le listener sur le bouton \"Rejouer\" si présent\n   */\n  function mount() {\n    shuffleCards(cards);\n\n    cards.forEach((card) => {\n      card.addEventListener(\"click\", flipCard);\n    });\n\n    // A11y : rôle bouton + focus clavier + Enter/Espace\n    initCardsA11y(cards);\n\n    if (replayButton) {\n      replayButton.addEventListener(\"click\", restartGame);\n    }\n\n    if (overlay) {\n      overlay.hidden = true;\n    }\n    if (gameContainer) {\n      gameContainer.classList.remove(\"win\");\n    }\n  }\n\n  return { mount };\n}\n","import { initThemeToggle } from \"./modules/theme-toggle.js\";\nimport { initSoundToggle, preloadAllSounds } from \"./modules/sound.js\";\nimport { createGame } from \"./modules/game.js\";\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  preloadAllSounds();\n  initThemeToggle();\n  initSoundToggle();\n  initGame();\n});\n\nexport function initGame() {\n  const game = createGame();\n  game.mount();\n}\n"],"names":["STORAGE_KEY","getPreferredTheme","saved","applyTheme","theme","root","input","initThemeToggle","nextTheme","SOUND_PATHS","SOUND_VOLUME","soundState","audioMap","createAudio","key","src","audio","volume","getAudio","preloadAllSounds","playSound","name","initSoundToggle","button","render","shuffleCards","cards","total","card","enhanceMemoryCard","handleKeyDown","event","initCardsA11y","createGame","gameContainer","overlay","lottieEl","replayButton","hasFlippedCard","lockBoard","firstCard","secondCard","resetBoard","unflipCard","disableCards","matchedA","matchedB","flipCard","allFlippedCard","checkForMatch","matched","restartGame","mount","initGame"],"mappings":"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"}